import{_ as D,D as h,o as d,c as i,a as e,x as p,y as r,J as k,m as M,d as m,F as f,u as w,r as _,t as u}from"./index-BvTcxZWB.js";import{b as C}from"./bootstrap.min-Bxag7N4e.js";import{p as $}from"./PaginationView-f3RnhuSh.js";import{c as I}from"./checkLogin-BdxS32oh.js";const b="https://vue3-course-api.hexschool.io/v2",g="hogwarts",L={props:["getItem"],data(){return{couponModal:null,currentDay:"",edit:!1,tempData:{title:"",is_enabled:0,percent:void 0,due_date:void 0,code:""}}},methods:{save(n){this.tempData.due_date=new Date(this.tempData.due_date).getTime()/1e3,this.tempData.is_enabled==!0?this.tempData.is_enabled=1:this.tempData.is_enabled=0;const t=this.tempData;this.edit==!0?h.put(`${b}/api/${g}/admin/coupon/${n}`,{data:t}).then(c=>{console.log(c.data.message),this.getItem(),this.couponModal.hide()}).catch(c=>{window.alert(c.response.data.message)}):h.post(`${b}/api/${g}/admin/coupon`,{data:t}).then(c=>{console.log(c.data.message),this.getItem(),this.couponModal.hide()}).catch(c=>{window.alert(c.response.data.message)})},close(){this.tempData={},this.couponModal.hide()},showModal(n){if(n.id!==void 0){this.edit=!0,this.tempData={...n};const t=new Date(this.tempData.due_date*1e3).toISOString().substr(0,10);this.tempData.due_date=t,this.couponModal.show()}else this.edit=!1,this.couponModal.show(),this.getItem(),this.couponModal.hide()},deleteItem(n){h.delete(`${b}/api/${g}/admin/coupon/${n}`).then(t=>{console.log(t.data.message),this.getItem(),this.couponModal.hide()}).catch(t=>{window.alert(t.response.data.message)})}},mounted(){this.couponModal=new C.Modal(this.$refs.couponModal,{keyboard:!1,backdrop:"static"});const n=new Date;this.currentDay=n.toISOString().substr(0,10)}},V={class:"modal fade",ref:"couponModal",tabindex:"-1"},T={class:"modal-dialog"},S={class:"modal-content"},U={class:"modal-header"},E={key:0,class:"modal-title",id:"exampleModalLabel"},A={key:1,class:"modal-title",id:"exampleModalLabel"},O={class:"modal-body"},j={class:"mb-3"},B=e("label",{for:"couponTitle",class:"form-label"},"專案名稱",-1),F={class:"mb-3"},H=e("label",{for:"couponDiscount",class:"form-label"},"減免度",-1),N={class:"mb-3"},P=e("label",{for:"couponDue",class:"form-label"},"期限",-1),R=["min","value"],z={class:"mb-3"},J=e("label",{for:"couponCode",class:"form-label"},"減免代碼",-1),Y={class:"form-check"},q=["checked"],G=e("label",{class:"form-check-label",for:"flexCheckChecked"}," 啟用 ",-1),K={class:"modal-footer d-flex justify-content-between"};function Q(n,t,c,v,o,a){return d(),i("div",V,[e("div",T,[e("div",S,[e("div",U,[o.tempData.id?(d(),i("h5",E,"編輯學費減免專案")):(d(),i("h5",A,"新增學費減免專案")),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...s)=>a.close&&a.close(...s))})]),e("div",O,[e("div",j,[B,p(e("input",{type:"text",class:"form-control",id:"couponTitle",placeholder:"請輸入專案名稱","onUpdate:modelValue":t[1]||(t[1]=s=>o.tempData.title=s)},null,512),[[r,o.tempData.title]])]),e("div",F,[H,p(e("input",{type:"number",class:"form-control",id:"couponDiscount",placeholder:"請輸入減免比例","onUpdate:modelValue":t[2]||(t[2]=s=>o.tempData.percent=s)},null,512),[[r,o.tempData.percent]])]),e("div",N,[P,p(e("input",{type:"date",class:"form-control",id:"couponDue",placeholder:"請輸入期限",min:o.currentDay,value:o.tempData.due_date,"onUpdate:modelValue":t[3]||(t[3]=s=>o.tempData.due_date=s)},null,8,R),[[r,o.tempData.due_date]])]),e("div",z,[J,p(e("input",{type:"text",class:"form-control",id:"couponCode",placeholder:"請輸入減免代碼","onUpdate:modelValue":t[4]||(t[4]=s=>o.tempData.code=s)},null,512),[[r,o.tempData.code]])]),e("div",Y,[p(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckChecked","onUpdate:modelValue":t[5]||(t[5]=s=>o.tempData.is_enabled=s),checked:o.tempData.is_enabled},null,8,q),[[k,o.tempData.is_enabled]]),G])]),e("div",K,[e("div",null,[e("button",{type:"button",class:"btn btn-danger",onClick:t[6]||(t[6]=s=>a.deleteItem(o.tempData.id))},"Delete")]),e("div",null,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[7]||(t[7]=(...s)=>a.close&&a.close(...s))},"Close"),e("button",{type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=s=>a.save(o.tempData.id))},"Save changes")])])])])],512)}const W=D(L,[["render",Q]]),X="https://vue3-course-api.hexschool.io/v2",Z="hogwarts",ee={components:{couponModal:W,pagination:$},data(){return{couponList:[],isLoading:!0,tempCoupon:{},pages:{}}},methods:{openCouponModal(n){this.$refs.coupon.showModal(n)},getItem(n=1){h.get(`${X}/api/${Z}/admin/coupons?page=${n}`).then(t=>{console.log(t),this.pages=t.data.pagination,this.couponList=t.data.coupons,this.isLoading=!1}).catch(t=>{console.log(t)})}},computed:{...M(I,["isLogin"])},mounted(){this.isLogin==!1?this.$router.push({name:"login"}):this.getItem()}},te={class:"container py-4 vh-100"},oe=e("h1",null,"學費減免管理",-1),se={class:"d-flex justify-content-end mb-2"},ne=e("i",{class:"fa-solid fa-plus d-flex justify-content-end",style:{"font-size":"16px"}},null,-1),ae=e("p",{class:"mb-0 ms-1"},"Add new code",-1),le=[ne,ae],ce={class:"table table-warning table-bordered border-primary table-hover"},de=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"text-center"},"專案名稱"),e("th",{scope:"col",class:"text-center"},"減免額度"),e("th",{scope:"col",class:"text-center"},"到期日"),e("th",{scope:"col",class:"text-center"},"code"),e("th",{scope:"col",class:"text-center"},"狀態"),e("th",{scope:"col",class:"text-center"},"編輯")])],-1),ie={class:"text-center"},pe={class:"text-center"},re={class:"text-center"},ue={class:"text-center"},he={class:"text-center"},me={key:0},_e={key:1},be={class:"text-center"},ge=["onClick"],fe=e("i",{class:"fa-solid fa-key text-warning"},null,-1),De=[fe];function ve(n,t,c,v,o,a){const s=_("LaodingOverlay"),x=_("pagination"),y=_("couponModal");return d(),i(f,null,[m(s,{active:o.isLoading},null,8,["active"]),e("div",te,[oe,e("div",se,[e("button",{type:"button",class:"btn btn-outline-primary d-flex align-items-center mb-3",onClick:t[0]||(t[0]=(...l)=>a.openCouponModal&&a.openCouponModal(...l))},le)]),e("table",ce,[de,e("tbody",null,[(d(!0),i(f,null,w(o.couponList,l=>(d(),i("tr",{key:l.id},[e("td",ie,u(l.title),1),e("td",pe,u(l.percent==0?"全免":`${100-l.percent}% off`),1),e("td",re,u(`
      ${new Date(l.due_date*1e3).getFullYear()} /
      ${new Date(l.due_date*1e3).getMonth()+1} /
        ${new Date(l.due_date*1e3).getDate()}
      `),1),e("td",ue,u(l.code),1),e("td",he,[l.is_enabled==!0?(d(),i("p",me,"已開放")):(d(),i("p",_e,"未開放"))]),e("td",be,[e("button",{title:"Alohomora ",class:"bg-transparent border-0",onClick:xe=>a.openCouponModal(l)},De,8,ge)])]))),128))])]),m(x,{pages:o.pages,getItem:a.getItem},null,8,["pages","getItem"])]),m(y,{ref:"coupon",getItem:a.getItem},null,8,["getItem"])],64)}const Ce=D(ee,[["render",ve]]);export{Ce as default};
