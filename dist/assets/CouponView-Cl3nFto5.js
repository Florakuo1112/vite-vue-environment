import{_ as D,G as h,o as d,c as i,a as e,z as p,A as r,K as y,m as C,d as b,F as f,g as k,r as g,t as u}from"./index-Bavkz2tH.js";import{b as M}from"./bootstrap.min-BX-e7Dm5.js";import{c as w}from"./checkLogin-zC808EN4.js";const _="https://vue3-course-api.hexschool.io/v2",m="hogwarts",$={props:["getCoupons"],data(){return{couponModal:null,currentDay:"",edit:!1,tempData:{title:"",is_enabled:0,percent:void 0,due_date:void 0,code:""}}},methods:{save(s){this.tempData.due_date=new Date(this.tempData.due_date).getTime()/1e3,this.tempData.is_enabled==!0?this.tempData.is_enabled=1:this.tempData.is_enabled=0;const t=this.tempData;this.edit==!0?h.put(`${_}/api/${m}/admin/coupon/${s}`,{data:t}).then(c=>{console.log(c.data.message),this.getCoupons(),this.couponModal.hide()}).catch(c=>{window.alert(c.response.data.message)}):h.post(`${_}/api/${m}/admin/coupon`,{data:t}).then(c=>{console.log(c.data.message),this.getCoupons(),this.couponModal.hide()}).catch(c=>{window.alert(c.response.data.message)})},close(){this.tempData={},this.couponModal.hide()},showModal(s){if(s.id!==void 0){this.edit=!0,this.tempData={...s};const t=new Date(this.tempData.due_date*1e3).toISOString().substr(0,10);this.tempData.due_date=t,this.couponModal.show()}else this.edit=!1,this.couponModal.show(res.data.message),this.getCoupons(),this.couponModal.hide()},deleteItem(s){h.delete(`${_}/api/${m}/admin/coupon/${s}`).then(t=>{console.log(t.data.message),this.getCoupons(),this.couponModal.hide()}).catch(t=>{window.alert(t.response.data.message)})}},mounted(){this.couponModal=new M.Modal(this.$refs.couponModal,{keyboard:!1,backdrop:"static"});const s=new Date;this.currentDay=s.toISOString().substr(0,10)}},L={class:"modal fade",ref:"couponModal",tabindex:"-1"},V={class:"modal-dialog"},T={class:"modal-content"},I={class:"modal-header"},S={key:0,class:"modal-title",id:"exampleModalLabel"},U={key:1,class:"modal-title",id:"exampleModalLabel"},E={class:"modal-body"},A={class:"mb-3"},O=e("label",{for:"couponTitle",class:"form-label"},"專案名稱",-1),j={class:"mb-3"},B=e("label",{for:"couponDiscount",class:"form-label"},"減免度",-1),F={class:"mb-3"},z=e("label",{for:"couponDue",class:"form-label"},"期限",-1),H=["min","value"],N={class:"mb-3"},P=e("label",{for:"couponCode",class:"form-label"},"減免代碼",-1),R={class:"form-check"},G=["checked"],K=e("label",{class:"form-check-label",for:"flexCheckChecked"}," 啟用 ",-1),Y={class:"modal-footer d-flex justify-content-between"};function q(s,t,c,v,o,l){return d(),i("div",L,[e("div",V,[e("div",T,[e("div",I,[o.tempData.id?(d(),i("h5",S,"編輯學費減免專案")):(d(),i("h5",U,"新增學費減免專案")),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...n)=>l.close&&l.close(...n))})]),e("div",E,[e("div",A,[O,p(e("input",{type:"text",class:"form-control",id:"couponTitle",placeholder:"請輸入專案名稱","onUpdate:modelValue":t[1]||(t[1]=n=>o.tempData.title=n)},null,512),[[r,o.tempData.title]])]),e("div",j,[B,p(e("input",{type:"number",class:"form-control",id:"couponDiscount",placeholder:"請輸入減免比例","onUpdate:modelValue":t[2]||(t[2]=n=>o.tempData.percent=n)},null,512),[[r,o.tempData.percent]])]),e("div",F,[z,p(e("input",{type:"date",class:"form-control",id:"couponDue",placeholder:"請輸入期限",min:o.currentDay,value:o.tempData.due_date,"onUpdate:modelValue":t[3]||(t[3]=n=>o.tempData.due_date=n)},null,8,H),[[r,o.tempData.due_date]])]),e("div",N,[P,p(e("input",{type:"text",class:"form-control",id:"couponCode",placeholder:"請輸入減免代碼","onUpdate:modelValue":t[4]||(t[4]=n=>o.tempData.code=n)},null,512),[[r,o.tempData.code]])]),e("div",R,[p(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckChecked","onUpdate:modelValue":t[5]||(t[5]=n=>o.tempData.is_enabled=n),checked:o.tempData.is_enabled},null,8,G),[[y,o.tempData.is_enabled]]),K])]),e("div",Y,[e("div",null,[e("button",{type:"button",class:"btn btn-danger",onClick:t[6]||(t[6]=n=>l.deleteItem(o.tempData.id))},"Delete")]),e("div",null,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[7]||(t[7]=(...n)=>l.close&&l.close(...n))},"Close"),e("button",{type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=n=>l.save(o.tempData.id))},"Save changes")])])])])],512)}const J=D($,[["render",q]]),Q="https://vue3-course-api.hexschool.io/v2",W="hogwarts",X={components:{couponModal:J},data(){return{couponList:[],isLoading:!0,tempCoupon:{}}},methods:{openCouponModal(s){this.$refs.coupon.showModal(s)},getCoupons(){h.get(`${Q}/api/${W}/admin/coupons`).then(s=>{console.log(s),this.couponList=s.data.coupons,this.isLoading=!1}).catch(s=>{console.log(s)})}},computed:{...C(w,["isLogin"])},mounted(){this.isLogin==!1?this.$router.push({name:"login"}):this.getCoupons()}},Z={class:"container py-4 vh-100"},ee=e("h1",null,"學費減免管理",-1),te={class:"d-flex justify-content-end mb-2"},oe=e("i",{class:"fa-solid fa-plus d-flex justify-content-end",style:{"font-size":"16px"}},null,-1),se=e("p",{class:"mb-0 ms-1"},"Add new code",-1),ne=[oe,se],ae={class:"table table-warning table-bordered border-primary table-hover"},le=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"text-center"},"專案名稱"),e("th",{scope:"col",class:"text-center"},"減免額度"),e("th",{scope:"col",class:"text-center"},"到期日"),e("th",{scope:"col",class:"text-center"},"code"),e("th",{scope:"col",class:"text-center"},"狀態"),e("th",{scope:"col",class:"text-center"},"編輯")])],-1),ce={class:"text-center"},de={class:"text-center"},ie={class:"text-center"},pe={class:"text-center"},re={class:"text-center"},ue={key:0},he={key:1},_e={class:"text-center"},me=["onClick"],be=e("i",{class:"fa-solid fa-key text-warning"},null,-1),fe=[be];function ge(s,t,c,v,o,l){const n=g("LaodingOverlay"),x=g("couponModal");return d(),i(f,null,[b(n,{active:o.isLoading},null,8,["active"]),e("div",Z,[ee,e("div",te,[e("button",{type:"button",class:"btn btn-outline-primary d-flex align-items-center mb-3",onClick:t[0]||(t[0]=(...a)=>l.openCouponModal&&l.openCouponModal(...a))},ne)]),e("table",ae,[le,e("tbody",null,[(d(!0),i(f,null,k(o.couponList,a=>(d(),i("tr",{key:a.id},[e("td",ce,u(a.title),1),e("td",de,u(a.percent==0?"全免":`${100-a.percent}% off`),1),e("td",ie,u(`
      ${new Date(a.due_date*1e3).getFullYear()} /
      ${new Date(a.due_date*1e3).getMonth()+1} /
        ${new Date(a.due_date*1e3).getDate()}
      `),1),e("td",pe,u(a.code),1),e("td",re,[a.is_enabled==!0?(d(),i("p",ue,"已開放")):(d(),i("p",he,"未開放"))]),e("td",_e,[e("button",{title:"Alohomora ",class:"bg-transparent border-0",onClick:De=>l.openCouponModal(a)},fe,8,me)])]))),128))])])]),b(x,{ref:"coupon",getCoupons:l.getCoupons},null,8,["getCoupons"])],64)}const Ce=D(X,[["render",ge]]);export{Ce as default};
